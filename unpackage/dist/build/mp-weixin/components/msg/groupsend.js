(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/msg/groupsend"],{"01aa":function(n,t,e){"use strict";(function(n){e("f9a0");o(e("66fd"));var t=o(e("1b97"));function o(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,e("543d")["createPage"])},"1b97":function(n,t,e){"use strict";e.r(t);var o=e("a926"),i=e("cd5f");for(var s in i)"default"!==s&&function(n){e.d(t,n,(function(){return i[n]}))}(s);e("1bb4");var c,l=e("f0c5"),u=Object(l["a"])(i["default"],o["b"],o["c"],!1,null,"7010f68c",null,!1,o["a"],c);t["default"]=u.exports},"1bb4":function(n,t,e){"use strict";var o=e("1f4c"),i=e.n(o);i.a},"1f4c":function(n,t,e){},"4d77":function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(e("a34a"));function i(n){return n&&n.__esModule?n:{default:n}}function s(n,t,e,o,i,s,c){try{var l=n[s](c),u=l.value}catch(a){return void e(a)}l.done?t(u):Promise.resolve(u).then(o,i)}function c(n){return function(){var t=this,e=arguments;return new Promise((function(o,i){var c=n.apply(t,e);function l(n){s(c,o,i,l,u,"next",n)}function u(n){s(c,o,i,l,u,"throw",n)}l(void 0)}))}}var l=function(){e.e("components/common/buslist").then(function(){return resolve(e("a8a2"))}.bind(null,e)).catch(e.oe)},u=function(){e.e("components/common/xfl-select/xfl-select").then(function(){return resolve(e("b50b"))}.bind(null,e)).catch(e.oe)},a={components:{Buslist:l,xflSelect:u},data:function(){return{list1:[],selectValue:"",lineStrlist:[],lineList:[],id:null,lineId:null,content:"",imgList:[],imgurl:""}},onLoad:function(n){this.id=n.id,this.getLines(),this.imgurl=this.$imgurl},methods:{getLines:function(){var n=this;this.$http.post("sLine/securityLineQuery",{id:this.id}).then((function(t){if(100==t.code){var e=t.info;n.lineList=[],n.lineStrlist=[],e.forEach((function(t,e){n.lineList.push(t),n.lineStrlist.push(t.name)})),n.selectValue=n.lineStrlist[0],n.lineId=n.lineList[0].lineId}}))},selectChange:function(n){console.log(n);var t=n.index;this.lineId=this.lineList[t].lineId},getSite:function(){},isOk:function(){console.log(this.content),console.log(this.lineId),this.content?this.lineId?(n.showLoading({icon:"loading",title:"正在发送"}),this.$http.post("sMessage/sendGroupMsg",{securityId:this.id,lineId:this.lineId,content:this.content,photos:this.imgList}).then((function(t){100==t.code?(n.hideLoading(),n.showToast({icon:"success",title:"发送成功！"}),n.navigateBack({})):250==t.code&&n.showToast({icon:"none",title:t.msg})}))):n.showToast({icon:"none",title:"请选择线路"}):n.showToast({icon:"none",title:"请输入消息内容"})},uploadImg:function(){var t=this,e=1;console.log("上传图片"),console.log(this.imgList),t.imgList.length<3?n.chooseImage({fail:function(){n.hideLoading(),n.showToast({icon:"none",title:"上传失败"})},success:function(){var i=c(o.default.mark((function i(s){var l,u;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:console.log("成功"),console.log(s),l=[],l=s.tempFilePaths,n.showLoading({title:"正在上传中"}),"",u=n.getStorageSync("userinfo"),u&&(u=JSON.parse(u),u.token),l.forEach(function(){var i=c(o.default.mark((function i(s,c){var u;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:console.log("上传"),console.log(s),u=s,console.log(JSON.stringify(u)),n.uploadFile({url:t.$imgurl+"file/uploadOSS",header:{"Content-type":"multipart/form-data"},filePath:u,name:"file",success:function(o){console.log("已上传数量"+t.imgList.length),console.log(o);var i=o.data;i=JSON.parse(i),100==i.code?t.imgList.length<3?(console.log("上传成功"+c),console.log(i.info),t.imgList.push(i.info),c==l.length-1&&n.hideLoading()):1==e&&(n.showToast({title:"图片上传数量已到",icon:"none",success:function(){setTimeout((function(){n.hideToast()}),2e3)}}),e++):n.showToast({icon:"none",title:"上传失败"})},fail:function(t){console.log("上传失败"+c),console.log(t),n.showToast({title:"上传失败",icon:"none",success:function(){setTimeout((function(){n.hideToast()}),2e3)}})}});case 5:case"end":return o.stop()}}),i)})));return function(n,t){return i.apply(this,arguments)}}());case 9:case"end":return i.stop()}}),i)})));function s(n){return i.apply(this,arguments)}return s}()}):n.showToast({title:"图片最多上传3张",icon:"none",success:function(){setTimeout((function(){n.hideToast()}),2e3)}})},deleteImg:function(n){this.imgList.splice(n,1)}}};t.default=a}).call(this,e("543d")["default"])},a926:function(n,t,e){"use strict";var o;e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return s})),e.d(t,"a",(function(){return o}));var i=function(){var n=this,t=n.$createElement;n._self._c},s=[]},cd5f:function(n,t,e){"use strict";e.r(t);var o=e("4d77"),i=e.n(o);for(var s in o)"default"!==s&&function(n){e.d(t,n,(function(){return o[n]}))}(s);t["default"]=i.a}},[["01aa","common/runtime","common/vendor"]]]);